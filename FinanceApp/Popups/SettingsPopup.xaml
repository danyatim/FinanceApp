<toolkit:Popup xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
               xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
               xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
               x:Class="FinanceApp.Popups.SettingsPopup"
               CanBeDismissedByTappingOutsideOfPopup="False"
               Color="#88D4F2"
               Size="600,500">   

    <VerticalStackLayout Padding="16" Spacing="16">
        <FlexLayout JustifyContent="SpaceBetween">
            <Label Text="Настройки справочников" Style="{StaticResource ListHeaderStyle}" />
            <Button ImageSource="cross.png" Command="{Binding CloseCommand}" Background="Transparent" BorderWidth="0"/>
        </FlexLayout>
        
        <HorizontalStackLayout Spacing="8">
                <Entry Placeholder="Название счета" Text="{Binding NewAccountName}" WidthRequest="288" />
                <Button Text="Добавить" Command="{Binding AddAccountCommand}" Style="{StaticResource GreenButtonStyle}"/>
            </HorizontalStackLayout>

            <CollectionView Header="Счета:" ItemsSource="{Binding Accounts}" HeightRequest="120">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid ColumnDefinitions="*,Auto" RowDefinitions="*,*">
                            <Label Text="{Binding Name}" FontSize="16" VerticalTextAlignment="Center"/>
                            <Button Grid.Column="1" Text="Удалить" Style="{StaticResource RedButtonStyle}"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type toolkit:Popup}}, Path=BindingContext.DeleteAccountCommand}"
                                        CommandParameter="{Binding Id}" Background="Transparent"/>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>


            <HorizontalStackLayout Spacing="8">
                <Entry Placeholder="Название источника" WidthRequest="280"
                           Text="{Binding NewSourceName}"/>
                <Picker ItemsSource="{Binding SourceTypes}"
                        SelectedItem="{Binding NewSourceType}"/>
                <Button Text="Добавить" Command="{Binding AddSourceCommand}" Style="{StaticResource GreenButtonStyle}"/>
            </HorizontalStackLayout>

        <CollectionView Header="Источники (доход/расход):" ItemsSource="{Binding Sources}" HeightRequest="160">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Grid ColumnDefinitions="*,Auto,Auto" RowDefinitions="*,*">
                        <Label Text="{Binding Name}" VerticalOptions="Center" FontSize="16"/>
                        <Label Grid.Column="1" Text="{Binding Type}" VerticalOptions="Center" FontSize="14" Padding="0,0,10,0"/>
                        <Button Grid.Column="2" Text="Удалить" Style="{StaticResource RedButtonStyle}"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type toolkit:Popup}}, Path=BindingContext.DeleteSourceCommand}"
                                        CommandParameter="{Binding Id}" Background="Transparent" VerticalOptions="Center"/>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        
    </VerticalStackLayout>
</toolkit:Popup>